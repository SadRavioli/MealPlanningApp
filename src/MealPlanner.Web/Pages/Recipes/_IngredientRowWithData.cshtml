@using MealPlanner.Domain.Enums
@using MealPlanner.Application.DTOs.Ingredients
@using MealPlanner.Application.DTOs.Recipes
@model (int index, SaveRecipeIngredientDto ingredient, IEnumerable<IngredientDto> availableIngredients)

<div class="ingredient-row grid grid-cols-1 sm:grid-cols-12 gap-3 p-4 bg-gray-50 rounded-lg" id="ingredient-@Model.index">
    <!-- Ingredient Selection -->
    <div class="sm:col-span-4">
        <label class="block text-xs font-medium text-gray-700 mb-1">Ingredient</label>
        <select name="Recipe.Ingredients[@Model.index].IngredientId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm" required>
            <option value="">Select ingredient...</option>
            @foreach (var ingredient in Model.availableIngredients.OrderBy(i => i.Name))
            {
                <option value="@ingredient.Id" selected="@(ingredient.Id == Model.ingredient.IngredientId)">@ingredient.Name</option>
            }
        </select>
    </div>

    <!-- Quantity -->
    <div class="sm:col-span-2">
        <label class="block text-xs font-medium text-gray-700 mb-1">Quantity</label>
        <input type="number"
               name="Recipe.Ingredients[@Model.index].Quantity"
               value="@Model.ingredient.Quantity"
               step="0.01"
               min="0"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"
               placeholder="1.5"
               required />
    </div>

    <!-- Unit -->
    <div class="sm:col-span-3">
        <label class="block text-xs font-medium text-gray-700 mb-1">Unit</label>
        <select name="Recipe.Ingredients[@Model.index].Unit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm" required>
            <option value="">Select unit...</option>
            <optgroup label="Weight">
                <option value="@((int)MeasurementUnit.Gram)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Gram)">Gram (g)</option>
                <option value="@((int)MeasurementUnit.Kilogram)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Kilogram)">Kilogram (kg)</option>
                <option value="@((int)MeasurementUnit.Ounce)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Ounce)">Ounce (oz)</option>
                <option value="@((int)MeasurementUnit.Pound)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Pound)">Pound (lb)</option>
            </optgroup>
            <optgroup label="Volume">
                <option value="@((int)MeasurementUnit.Millilitre)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Millilitre)">Millilitre (ml)</option>
                <option value="@((int)MeasurementUnit.Litre)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Litre)">Litre (l)</option>
                <option value="@((int)MeasurementUnit.Teaspoon)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Teaspoon)">Teaspoon (tsp)</option>
                <option value="@((int)MeasurementUnit.Tablespoon)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Tablespoon)">Tablespoon (tbsp)</option>
                <option value="@((int)MeasurementUnit.Cup)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Cup)">Cup</option>
                <option value="@((int)MeasurementUnit.FluidOunce)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.FluidOunce)">Fluid Ounce (fl oz)</option>
            </optgroup>
            <optgroup label="Count">
                <option value="@((int)MeasurementUnit.Piece)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Piece)">Piece</option>
                <option value="@((int)MeasurementUnit.Whole)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Whole)">Whole</option>
                <option value="@((int)MeasurementUnit.Clove)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Clove)">Clove</option>
                <option value="@((int)MeasurementUnit.Slice)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Slice)">Slice</option>
                <option value="@((int)MeasurementUnit.Pinch)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.Pinch)">Pinch</option>
            </optgroup>
            <optgroup label="Other">
                <option value="@((int)MeasurementUnit.ToTaste)" selected="@(Model.ingredient.Unit == (int)MeasurementUnit.ToTaste)">To Taste</option>
            </optgroup>
        </select>
    </div>

    <!-- Remove Button -->
    <div class="sm:col-span-3 flex items-end">
        <button type="button"
                onclick="this.closest('.ingredient-row').remove(); updateIngredientIndices();"
                class="w-full px-3 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors text-sm font-medium">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            Remove
        </button>
    </div>

    <!-- Notes (full width) -->
    <div class="sm:col-span-12">
        <label class="block text-xs font-medium text-gray-700 mb-1">Notes (optional)</label>
        <input type="text"
               name="Recipe.Ingredients[@Model.index].Notes"
               value="@Model.ingredient.Notes"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"
               placeholder="e.g., finely chopped, diced..." />
    </div>
</div>
